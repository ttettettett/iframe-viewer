<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マルハン蒲田駅東店 ピボットテーブル</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        #hallSelector {
            display: block;
            margin: 10px auto 20px auto;
        }

        #filterSection {
            margin-bottom: 20px;
        }

        #output {
            margin-top: 20px;
        }

        #daySelector {
            width: 100%;
            height: 150px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.23.0/pivot.min.css">
</head>
<body>
    <div class="container">
        <h2>マルハン蒲田駅東店 ピボットテーブル</h2>
        
        <!-- セレクトボックス -->
        <select id="hallSelector">
            <option value="マルハン蒲田駅東店" selected>マルハン蒲田駅東店</option>
        </select>

        <!-- 日付の複数選択 -->
        <div id="filterSection">
            <label>日付選択:</label>
            <select id="daySelector" multiple>
                <option value="01">1日</option>
                <option value="02">2日</option>
                <option value="03">3日</option>
                <option value="04">4日</option>
                <option value="05">5日</option>
                <option value="06">6日</option>
                <option value="07">7日</option>
                <option value="08">8日</option>
                <option value="09">9日</option>
                <option value="10">10日</option>
                <option value="11">11日</option>
                <option value="12">12日</option>
                <option value="13">13日</option>
                <option value="14">14日</option>
                <option value="15">15日</option>
                <option value="16">16日</option>
                <option value="17">17日</option>
                <option value="18">18日</option>
                <option value="19">19日</option>
                <option value="20">20日</option>
                <option value="21">21日</option>
                <option value="22">22日</option>
                <option value="23">23日</option>
                <option value="24">24日</option>
                <option value="25">25日</option>
                <option value="26">26日</option>
                <option value="27">27日</option>
                <option value="28">28日</option>
                <option value="29">29日</option>
                <option value="30">30日</option>
                <option value="31">31日</option>
            </select>
            <button onclick="applyFilter()">適用</button>
        </div>

        <!-- ピボットテーブル出力 -->
        <div id="output"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/papaparse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.23.0/pivot.min.js"></script>
    <script>
        const hallSelector = document.getElementById('hallSelector');
        const output = document.getElementById('output');
        const daySelector = document.getElementById('daySelector');

        let originalData = [];

        // === 初期表示で読み込み ===
        const fileName = `./差枚数/マルハン蒲田駅東店.csv`;

        fetch(fileName)
            .then(response => response.text())
            .then(csvData => {
                Papa.parse(csvData, {
                    header: true,
                    complete: function(results) {
                        originalData = results.data;
                        renderTable(originalData);
                    }
                });
            })
            .catch(error => console.error("[ERROR] CSVファイルの読み込みに失敗しました:", error));

        // === フィルターの適用 ===
        function applyFilter() {
            const selectedDays = Array.from(daySelector.selectedOptions).map(option => option.value);

            const filteredData = originalData.filter(row => {
                const day = new Date(row["日付"]).getDate().toString().padStart(2, '0');
                return selectedDays.includes(day);
            });

            renderTable(filteredData);
        }

        // === ピボットテーブル描画 ===
        function renderTable(data) {
            output.innerHTML = "";
            $(output).pivotUI(data, {
                rows: ["日付"],
                cols: ["機種名"],
                aggregatorName: "Average",
                vals: ["差枚数"],
                rendererName: "Heatmap"
            });
        }
    </script>
</body>
</html>